<!-----

You have some errors, warnings, or alerts. If you are using reckless mode, turn it off to see inline alerts.
* ERRORs: 0
* WARNINGs: 0
* ALERTS: 7

Conversion time: 2.05 seconds.


Using this Markdown file:

1. Paste this output into your source file.
2. See the notes and action items below regarding this conversion run.
3. Check the rendered output (headings, lists, code blocks, tables) for proper
   formatting and use a linkchecker before you publish this page.

Conversion notes:

* Docs to Markdown version 1.0β34
* Sat Jul 29 2023 06:20:20 GMT-0700 (PDT)
* Source doc: Untitled document
* This document has images: check for >>>>>  gd2md-html alert:  inline image link in generated source and store images to your server. NOTE: Images in exported zip file from Google Docs may not appear in  the same order as they do in your doc. Please check the images!

----->


<p style="color: red; font-weight: bold">>>>>>  gd2md-html alert:  ERRORs: 0; WARNINGs: 0; ALERTS: 7.</p>
<ul style="color: red; font-weight: bold"><li>See top comment block for details on ERRORs and WARNINGs. <li>In the converted Markdown or HTML, search for inline alerts that start with >>>>>  gd2md-html alert:  for specific instances that need correction.</ul>

<p style="color: red; font-weight: bold">Links to alert messages:</p><a href="#gdcalert1">alert1</a>
<a href="#gdcalert2">alert2</a>
<a href="#gdcalert3">alert3</a>
<a href="#gdcalert4">alert4</a>
<a href="#gdcalert5">alert5</a>
<a href="#gdcalert6">alert6</a>
<a href="#gdcalert7">alert7</a>

<p style="color: red; font-weight: bold">>>>>> PLEASE check and correct alert issues and delete this message and the inline alerts.<hr></p>



## **Overview**

[In a report dated July 11, 2023](https://www.microsoft.com/en-us/security/blog/2023/07/11/storm-0978-attacks-reveal-financial-and-espionage-motives/), Microsoft identified a phishing campaign targeting government and defense organizations in Europe and North America. The campaign operates by abusing the vulnerability CVE-2023-36884, which uses a phishing email with a malicious Word document that exploits a remote code execution (RCE) vulnerability. The lure of the phishing emails is related to the Ukranian World Congress.

Threat actor group **Storm-0978**, also known as RomCom, is a Russian-based cybercriminal group that's known to focus its operations on ransomware and extortion. They've also been associated with the RomCom backdoor, hence their namesake.

This group has been tracked for several years and has had successful high-profile attacks. But this lab will focus specifically on the 2023 campaign. It covers how the phishing operation works and analysis of the malicious Word document that was successfully used against diplomats at the **NATO Summit**.


## **Phishing**

The attack successfully took place because one or more individuals at the NATO Summit downloaded a malicious Word document that they believed to be genuine. Similar attacks were identified by Microsoft to target telecommunications and finance sectors as well, with these being largely opportunistic.



<p id="gdcalert1" ><span style="color: red; font-weight: bold">>>>>>  gd2md-html alert: inline image link here (to images/image1.png). Store image on your image server and adjust path/filename/extension if necessary. </span><br>(<a href="#">Back to top</a>)(<a href="#gdcalert2">Next alert</a>)<br><span style="color: red; font-weight: bold">>>>>> </span></p>


![alt_text](images/image1.png "image_tooltip")


Source: https://www.microsoft.com/en-us/security/blog/2023/07/11/storm-0978-attacks-reveal-financial-and-espionage-motives/

The initial email sent to individuals at the Summit contained two links to `doc` files that could be downloaded, with the instructions stipulating that the recipients needed to fill in forms and read the overview sheet.



<p id="gdcalert2" ><span style="color: red; font-weight: bold">>>>>>  gd2md-html alert: inline image link here (to images/image2.png). Store image on your image server and adjust path/filename/extension if necessary. </span><br>(<a href="#">Back to top</a>)(<a href="#gdcalert3">Next alert</a>)<br><span style="color: red; font-weight: bold">>>>>> </span></p>


![alt_text](images/image2.png "image_tooltip")


Source: https://www.microsoft.com/en-us/security/blog/2023/07/11/storm-0978-attacks-reveal-financial-and-espionage-motives/

Once opened, the document contained talking points for a discussion around the Ukrainian World Congress' Ukraine In Nato campaign.


## **Exploit chain**

There are many steps in the exploit flow. Depending on the patch status or installed version of Office, there are a number of potential steps. A researcher at Volexity released a graphic showing the full exploit chain. This is shown below.



<p id="gdcalert3" ><span style="color: red; font-weight: bold">>>>>>  gd2md-html alert: inline image link here (to images/image3.jpg). Store image on your image server and adjust path/filename/extension if necessary. </span><br>(<a href="#">Back to top</a>)(<a href="#gdcalert4">Next alert</a>)<br><span style="color: red; font-weight: bold">>>>>> </span></p>


![alt_text](images/image3.jpg "image_tooltip")


https://twitter.com/r00tbsd/status/1679042071477338114/photo/1

Informative Alert

Not all artifacts are available in the public domain. As such, this lab focused on the initial infection up to the zip archive being deployed.


## **Document analysis**


### **Metadata**

Office documents provide a large amount of metadata that can be used to correlate attacks from threat actors across campaigns. This metadata can be helpful where elements like the name of a document or the contents change, but the computer account used to create the document remains the same. `ExifTool` can read these metadata entries for old and new Office documents.



<p id="gdcalert4" ><span style="color: red; font-weight: bold">>>>>>  gd2md-html alert: inline image link here (to images/image4.png). Store image on your image server and adjust path/filename/extension if necessary. </span><br>(<a href="#">Back to top</a>)(<a href="#gdcalert5">Next alert</a>)<br><span style="color: red; font-weight: bold">>>>>> </span></p>


![alt_text](images/image4.png "image_tooltip")


ExifTool output showing metadata for an Office document

Interesting metadata elements include:



* Creation date
* Modified date
* Last modified by


### **Parsing Office documents**

There are several methods to parse the contents of an Office document, depending on the file type. Office documents have several supported formats.



* OLE: This is the legacy format for Office documents before 2017. This file type stores the elements of a document as binary objects.
* XML: This newer format replaces OLE files and uses mostly XML structured data files to store the elements of documents. These XML components are all compressed using the zip format.
* RTF: This format was used as a step up from plain text files; the Rich Text Format could include formatting information like bold or italics alongside the content.
* HTML/XML: Office documents can also be written in web-based structures like HTML, CSS, and XML. If given a `.doc` the extension will open and render inside Office applications.

Several file extensions can be switched, and Office will still correctly load and determine the correct renderer.

Informative Alert

You can change the file extension of new-format Office documents to `.zip` and then access all the embedded files using a standard archive tool like `unzip`. OLE-type files require a special parser like `oletools` to extract the embedded objects.


### **Zip/XML structure**

There are a few key filetypes that are found in modern Office XML formatted documents:



* `[Content_Types].xml` – defines the content types and overrides for the document
* `_rels/.rels` – defines relationships between objects and components
* `docProps/core.xml` – properties relating to the document
* `word/document.xml` – the central part of the Word document



<p id="gdcalert5" ><span style="color: red; font-weight: bold">>>>>>  gd2md-html alert: inline image link here (to images/image5.png). Store image on your image server and adjust path/filename/extension if necessary. </span><br>(<a href="#">Back to top</a>)(<a href="#gdcalert6">Next alert</a>)<br><span style="color: red; font-weight: bold">>>>>> </span></p>


![alt_text](images/image5.png "image_tooltip")


Zip archive view of an office document

Alongside these core components, the archive will contain all the embedded components like files, images, or other embedded objects like RTFs, macros, or documents.



<p id="gdcalert6" ><span style="color: red; font-weight: bold">>>>>>  gd2md-html alert: inline image link here (to images/image6.png). Store image on your image server and adjust path/filename/extension if necessary. </span><br>(<a href="#">Back to top</a>)(<a href="#gdcalert7">Next alert</a>)<br><span style="color: red; font-weight: bold">>>>>> </span></p>


![alt_text](images/image6.png "image_tooltip")


Zipdump view of an office document


### **Oletools**

Several individual tools make up the `oletools` bundle. Most are designed to work on legacy formats like `ole`, but some tools can process other formats like zip, XML, and RTF.


#### **Tools to analyze malicious documents**



* `oleid` – analyzes OLE files to detect specific characteristics usually found in malicious files
* `olevba` – extracts and analyzes VBA macro source code from MS Office documents (OLE and Open XML)
* `MacroRaptor` – detects malicious VBA Macros
* `msodde` – detects and extracts DDE/DDEAUTO links from MS Office documents, RTF, and CSV files
* `pyxswf` – detects, extracts, and analyzes Flash objects (SWF) that may be embedded in files such as MS Office documents and RTF files, which is especially useful for malware analysis
* `oleobj` – extracts embedded objects from OLE files
* `rtfobj` – extracts embedded objects from RTF files



<p id="gdcalert7" ><span style="color: red; font-weight: bold">>>>>>  gd2md-html alert: inline image link here (to images/image7.png). Store image on your image server and adjust path/filename/extension if necessary. </span><br>(<a href="#">Back to top</a>)(<a href="#gdcalert8">Next alert</a>)<br><span style="color: red; font-weight: bold">>>>>> </span></p>


![alt_text](images/image7.png "image_tooltip")


rtfobj showing embedded objects


#### **Tools to analyze the structure of OLE files**



* `olebrowse` – a simple GUI to browse OLE files (e.g. MS Word, Excel, PowerPoint documents), allowing you to view and extract individual data streams
* `olemeta` – extracts all standard properties (metadata) from OLE files
* `oletimes` – extracts creation and modification timestamps of all streams and storages
* `oledir` – displays all the directory entries of an OLE file, including free and orphaned entries
* `olemap` – displays a map of all the sectors in an OLE file

**CVE ID:** CVE-2023-34362

**Base score: **8.8 High

**CVSS3.1:** CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H

**Description:** In Progress MOVEit Transfer before 2021.0.6 (13.0.6), 2021.1.4 (13.1.4), 2022.0.4 (14.0.4), 2022.1.5 (14.1.5), and 2023.0.1 (15.0.1).

An attacker could create a specially crafted Microsoft Office document that enables them to perform remote code execution in the context of the victim. However, an attacker would have to convince the victim to open the malicious file.

**Vulnerable versions:** Office365 Semi-Annual Channel Extended (specifically versions 2208 and 2202)

**NIST:** [https://nvd.nist.gov/vuln/detail/CVE-2023-36884](https://nvd.nist.gov/vuln/detail/CVE-2023-36884)

**MITRE:** [https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-36884](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-36884)

**AttackerKB:** [https://attackerkb.com/topics/XCxkPoxAmH/cve-2023-36884](https://attackerkb.com/topics/XCxkPoxAmH/cve-2023-36884)

The specific details related to the CVE and RCE components are still not fully understood or reported. There are several components of successful exploitation, which can be seen in the complex delivery mechanism. More details on the specifics can be found in these reports:



* [https://www.microsoft.com/en-us/security/blog/2023/07/11/storm-0978-attacks-reveal-financial-and-espionage-motives/](https://www.microsoft.com/en-us/security/blog/2023/07/11/storm-0978-attacks-reveal-financial-and-espionage-motives/)
* [https://blogs.blackberry.com/en/2023/07/romcom-targets-ukraine-nato-membership-talks-at-nato-summit](https://blogs.blackberry.com/en/2023/07/romcom-targets-ukraine-nato-membership-talks-at-nato-summit)


### **Mitigation**

Patching against the vulnerability should be a priority. However, if you aren't able to patch, mitigation is provided by Microsoft. Setting the [FEATURE_BLOCK_CROSS_PROTOCOL_FILE_NAVIGATION](https://learn.microsoft.com/archive/blogs/ieinternals/internet-explorer-9-0-2-update#new-restrictions-on-use-ofthe-file-protocol) registry key can avoid exploitation of this specific component.


### **Detection**

Sigma rules have been created that can be used to query SIEMS or log collection tools for the presence of known HTTP-based indicators.


```
title: Potential CVE-2023-36884 Exploitation - File Downloads
id: 6af1617f-c179-47e3-bd66-b28034a1052d
status: experimental
description: Detects files seen being requested by RomCom while potentially exploiting CVE-2023-36884
references:
    - https://blogs.blackberry.com/en/2023/07/romcom-targets-ukraine-nato-membership-talks-at-nato-summit
author: X__Junior
date: 2023/07/12
tags:
    - attack.command_and_control
    - cve.2023.36884
logsource:
    category: proxy
detection:
    selection:
        cs-method: 'GET'
        c-uri|contains:
            - '/ex001.url'
            - '/file001.search-ms'
            - '/file001.url'
            - '/file001.vbs'
            - '/file1.mht'
            - '/o2010.asp'
            - '/redir_obj.html'
            - '/RFile.asp'
            - '/zip_k.asp'
            - '/zip_k2.asp'
            - '/zip_k3.asp'
    condition: selection
falsepositives:
    - Unknown
level: medium
```
Source: * [https://github.com/SigmaHQ/sigma/blob/master/rules-emerging-threats/2023/Exploits/CVE-2023-36884/proxy_exploit_cve_2023_36884_office_windows_html_rce_traffic.yml](https://github.com/SigmaHQ/sigma/blob/master/rules-emerging-threats/2023/Exploits/CVE-2023-36884/proxy_exploit_cve_2023_36884_office_windows_html_rce_traffic.yml)
